{% macro render_paper(paper, latest_date=None) %}
<div class="paper" id="paper-{{ paper.arxiv_id }}">
    <div class="paper-authors-row">
        <div class="paper-date{% if latest_date and paper.published_date == latest_date %} latest-date{% endif %}">
            {{ paper.published_date }}
            {% if 'v' in paper.arxiv_id and paper.arxiv_id.split('v')[-1].isdigit() %}
                {% set version_num = paper.arxiv_id.split('v')[-1] %}
                {% if version_num|int > 1 %}
                    <span class="version-indicator" title="Updated version {{ version_num }}">v{{ version_num }}</span>
                {% endif %}
            {% endif %}
        </div>
        <div class="paper-authors">
            {% for author in paper.authors %}
                <a href="/author/{{ author }}">{{ author }}</a>{% if not loop.last %}, {% endif %}
            {% endfor %}
        </div>
        <div class="paper-links">
            <a href="#paper-{{ paper.arxiv_id }}" onclick="copyShareLink('{{ paper.arxiv_id }}'); return false;" title="Copy shareable link">#</a>
            <span class="bullet">•</span>
            <a href="/paper/{{ paper.arxiv_id }}" title="View details">INFO</a>
            <span class="bullet">•</span>
            <a href="#" onclick="copyBibtex('{{ paper.arxiv_id }}'); return false;" title="Copy arXiv BibTeX entry">BIB</a>
            <span class="bullet">•</span>
            <a href="https://arxiv.org/pdf/{{ paper.arxiv_id }}.pdf" target="_blank" rel="noopener" title="Download PDF">PDF</a>
            <span class="bullet">•</span>
            <a href="https://arxiv.org/abs/{{ paper.arxiv_id }}" target="_blank" rel="noopener" title="View on arXiv">ARXIV</a>
        </div>
    </div>

    <details class="abstract-details" data-arxiv-id="{{ paper.arxiv_id }}">
        <summary class="paper-title{% if paper.journal_ref or paper.doi %} published-paper{% endif %}">{{ paper.title }}</summary>

        {% if paper.journal_ref or paper.doi %}
        <div class="paper-publication">
            Published in {{ paper.journal_ref }}
            {% if paper.doi %}
                • <a href="https://doi.org/{{ paper.doi }}" target="_blank" rel="noopener">DOI</a>
                • <a href="https://doi.org/{{ paper.doi }}" target="_blank" rel="noopener">View Publication</a>
                • <a href="#" onclick="copyDoiBibtex('{{ paper.arxiv_id }}'); return false;" title="Copy published BibTeX entry">BIB</a>
            {% elif paper.journal_ref %}
                • <a href="https://scholar.google.com/scholar?q={{ (paper.title + ' ' + paper.journal_ref) | urlencode }}" target="_blank" rel="noopener">Search Publication</a>
            {% endif %}
        </div>
        {% endif %}

        <div class="paper-abstract">
            {{ paper.abstract }}
        </div>
    </details>
</div>
{% endmacro %}
